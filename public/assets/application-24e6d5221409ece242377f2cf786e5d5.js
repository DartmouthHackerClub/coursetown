// This source code is free for use in the public domain.
// NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
// http://code.google.com/p/json-sans-eval/
/**
 * Parses a string of well-formed JSON text.
 *
 * If the input is not well-formed, then behavior is undefined, but it is
 * deterministic and is guaranteed not to modify any object other than its
 * return value.
 *
 * This does not use `eval` so is less likely to have obscure security bugs than
 * json2.js.
 * It is optimized for speed, so is much faster than json_parse.js.
 *
 * This library should be used whenever security is a concern (when JSON may
 * come from an untrusted source), speed is a concern, and erroring on malformed
 * JSON is *not* a concern.
 *
 *                      Pros                   Cons
 *                    +-----------------------+-----------------------+
 * json_sans_eval.js  | Fast, secure          | Not validating        |
 *                    +-----------------------+-----------------------+
 * json_parse.js      | Validating, secure    | Slow                  |
 *                    +-----------------------+-----------------------+
 * json2.js           | Fast, some validation | Potentially insecure  |
 *                    +-----------------------+-----------------------+
 *
 * json2.js is very fast, but potentially insecure since it calls `eval` to
 * parse JSON data, so an attacker might be able to supply strange JS that
 * looks like JSON, but that executes arbitrary javascript.
 * If you do have to use json2.js with untrusted data, make sure you keep
 * your version of json2.js up to date so that you get patches as they're
 * released.
 *
 * @param {string} json per RFC 4627
 * @param {function (this:Object, string, *):*} opt_reviver optional function
 *     that reworks JSON objects post-parse per Chapter 15.12 of EcmaScript3.1.
 *     If supplied, the function is called with a string key, and a value.
 *     The value is the property of 'this'.  The reviver should return
 *     the value to use in its place.  So if dates were serialized as
 *     {@code { "type": "Date", "time": 1234 }}, then a reviver might look like
 *     {@code
 *     function (key, value) {
 *       if (value && typeof value === 'object' && 'Date' === value.type) {
 *         return new Date(value.time);
 *       } else {
 *         return value;
 *       }
 *     }}.
 *     If the reviver returns {@code undefined} then the property named by key
 *     will be deleted from its container.
 *     {@code this} is bound to the object containing the specified property.
 * @return {Object|Array}
 * @author Mike Samuel <mikesamuel@gmail.com>
 */
var jsonParse=function(){function o(e,t,n){return t?s[t]:String.fromCharCode(parseInt(n,16))}var e="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",t='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',n='(?:"'+t+'*")',r=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+e+"|"+n+")","g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),s={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},u=new String(""),a="\\",f={"{":Object,"[":Array},l=Object.hasOwnProperty;return function(e,t){var n=e.match(r),s,f=n[0],c=!1;"{"===f?s={}:"["===f?s=[]:(s=[],c=!0);var h,p=[s];for(var d=1-c,v=n.length;d<v;++d){f=n[d];var m;switch(f.charCodeAt(0)){default:m=p[0],m[h||m.length]=+f,h=void 0;break;case 34:f=f.substring(1,f.length-1),f.indexOf(a)!==-1&&(f=f.replace(i,o)),m=p[0];if(!h){if(!(m instanceof Array)){h=f||u;break}h=m.length}m[h]=f,h=void 0;break;case 91:m=p[0],p.unshift(m[h||m.length]=[]),h=void 0;break;case 93:p.shift();break;case 102:m=p[0],m[h||m.length]=!1,h=void 0;break;case 110:m=p[0],m[h||m.length]=null,h=void 0;break;case 116:m=p[0],m[h||m.length]=!0,h=void 0;break;case 123:m=p[0],p.unshift(m[h||m.length]={}),h=void 0;break;case 125:p.shift()}}if(c){if(p.length!==1)throw new Error;s=s[0]}else if(p.length)throw new Error;if(t){var g=function(e,n){var r=e[n];if(r&&typeof r=="object"){var i=null;for(var s in r)if(l.call(r,s)&&r!==e){var o=g(r,s);o!==void 0?r[s]=o:(i||(i=[]),i.push(s))}if(i)for(var u=i.length;--u>=0;)delete r[i[u]]}return t.call(e,n,r)};s=g({"":s},"")}return s}}(),dept_map={SIS:{name:"Student Initiated Seminar",id:"66"},AAAS:{name:"Afr & AfrAmerican Studies",id:"13"},COSC:{name:"Computer Science",id:"27"},AMEL:{name:"Asian/Mideast Lang/Lit",id:"14"},MUS:{name:"Music",id:"55"},COLT:{name:"Comparative Literature",id:"26"},ECON:{name:"Economics",id:"29"},ITAL:{name:"Italian",id:"45"},KORN:{name:"Korean Language and Literature",id:"75"},THEA:{name:"Theater",id:"71"},ENGG:{name:"Thayer School Of Engineering",id:"80"},ARAB:{name:"Arabic",id:"17"},NAS:{name:"Native American Studies",id:"56"},LACS:{name:"Latin Am/Caribbean Studies",id:"48"},CHIN:{name:"Chinese",id:"22"},SART:{name:"Studio Art",id:"64"},REL:{name:"Religion",id:"62"},PSYC:{name:"Psychology",id:"61"},LING:{name:"Linguistics/Cognitive Studies",id:"51"},ENGL:{name:"English",id:"31"},AMES:{name:"Asian/Mideast Studies",id:"15"},EDUC:{name:"Education",id:"30"},PORT:{name:"Portuguese",id:"60"},FILM:{name:"Film Studies",id:"34"},ENGM:{name:"Engineering Masters",id:"88"},BIOC:{name:"Biochemistry",id:"78"},ENGS:{name:"Engineering Sciences",id:"32"},SCI:{name:"Science",id:"65"},TUCK:{name:"Tuck",id:"77"},COGS:{name:"Cognitive Science",id:"25"},HUM:{name:"Humanities",id:"44"},PHIL:{name:"Philosophy",id:"58"},MALS:{name:"Liberal Studies",id:"52"},BIOL:{name:"Biology",id:"20"},GERM:{name:"German",id:"38"},HIST:{name:"History",id:"42"},WPS:{name:"War and Peace Studies",id:"76"},WRIT:{name:"Writing Program",id:"74"},COCO:{name:"College Course",id:"24"},ARTH:{name:"Art History",id:"18"},ASTR:{name:"Astronomy",id:"19"},WSGT:{name:"Women's Studies",id:"72"},GEOG:{name:"Geography",id:"37"},"??":{name:"Pharmacology and Toxicology",id:"83"},CLST:{name:"Classical Studies",id:"23"},FREN:{name:"French",id:"35"},JWST:{name:"Jewish Studies",id:"47"},FRIT:{name:"French/Italian in Translation",id:"36"},MICR:{name:"Microbiology",id:"82"},CHEM:{name:"Chemistry",id:"21"},PBPL:{name:"Public Policy",id:"57"},SSOC:{name:"Social Science",id:"70"},ANTH:{name:"Anthropology",id:"16"},INTS:{name:"International Studies",id:"87"},RUSS:{name:"Russian",id:"63"},GOVT:{name:"Government",id:"39"},PHYS:{name:"Physics",id:"59"},GRK:{name:"Greek",id:"40"},HUBI:{name:"Human Biology",id:"43"},SPEE:{name:"Speech",id:"69"},SPAN:{name:"Spanish",id:"68"},LATS:{name:"Latino Studies",id:"50"},"M&SS":{name:"Mathematics & Social Sciences",id:"54"},ENVS:{name:"Environmental Studies",id:"33"},HEBR:{name:"Hebrew",id:"41"},JAPN:{name:"Japanese",id:"46"},SOCY:{name:"Sociology",id:"67"},LAT:{name:"Latin",id:"49"},GENE:{name:"Genetics",id:"81"},MATH:{name:"Mathematics",id:"53"},EARS:{name:"Earth Sciences",id:"28"}};(function(){var e,t,n;e="/reviews/batch",n=0,t=function(e){var t,r,i,s,o;t=e.length;if(e.length===0)return $("#alert_box").hide(),$("#warning_box").show();n+=t,$("#alert_box").html("Submitted "+t+" new reviews ("+n+" total this session)"),$("#alert_box").show(),$("#warning_box").hide(),o=[];for(i=0,s=e.length;i<s;i++)r=e[i],$("#review_row_"+r).addClass("submitted"),$("#review_row_"+r+"_prof_comment").addClass("submitted-comment-row"),$("#review_row_"+r+"_workload_comment").addClass("submitted-comment-row"),o.push($("#review_row_"+r+"_course_comment").addClass("submitted-comment-row"));return o},$(document).ready(function(){return $("#alert_box").hide(),$("#warning_box").hide(),$("#warning_box").html("Woops, you didn't successfully submit any new reviews. Make sure you have all the required fields filled out (including 'Why?')"),$("#batch_review_submit").click(function(){return $.ajax({dataType:"json",type:"POST",url:e,data:$("#batch_review_form").serialize(),success:t,error:function(e){return console.log($("#batch_review_form").serialize()),$("#alert_box").hide(),$("#warning_box").show()}}),!1})})}).call(this),function(){}.call(this),function(e){var t={init:function(n){return this.each(function(){var r=this,i=e(r).empty();r.opt=e.extend(!0,{},e.fn.raty.defaults,n),i.data("settings",r.opt),r.opt.number=t.between(r.opt.number,0,20),r.opt.path.substring(r.opt.path.length-1,r.opt.path.length)!="/"&&(r.opt.path+="/"),typeof r.opt.score=="function"&&(r.opt.score=r.opt.score.call(r)),r.opt.score&&(r.opt.score=t.between(r.opt.score,0,r.opt.number));for(var s=1;s<=r.opt.number;s++)e("<img />",{src:r.opt.path+(!r.opt.score||r.opt.score<s?r.opt.starOff:r.opt.starOn),alt:s,title:s<=r.opt.hints.length&&r.opt.hints[s-1]!==null?r.opt.hints[s-1]:s}).appendTo(r),r.opt.space&&i.append(s<r.opt.number?"&#160;":"");r.stars=i.children('img:not(".raty-cancel")'),r.score=e("<input />",{type:"hidden",name:r.opt.scoreName}).appendTo(r),r.opt.score&&r.opt.score>0&&(r.score.val(r.opt.score),t.roundStar.call(r,r.opt.score)),r.opt.iconRange&&t.fill.call(r,r.opt.score),t.setTarget.call(r,r.opt.score,r.opt.targetKeep);var o=r.opt.space?4:0,u=r.opt.width||r.opt.number*r.opt.size+r.opt.number*o;r.opt.cancel&&(r.cancel=e("<img />",{src:r.opt.path+r.opt.cancelOff,alt:"x",title:r.opt.cancelHint,"class":"raty-cancel"}),r.opt.cancelPlace=="left"?i.prepend("&#160;").prepend(r.cancel):i.append("&#160;").append(r.cancel),u+=r.opt.size+o),r.opt.readOnly?(t.fixHint.call(r),r.cancel&&r.cancel.hide()):(i.css("cursor","pointer"),t.bindAction.call(r)),i.css("width",u)})},between:function(e,t,n){return Math.min(Math.max(parseFloat(e),t),n)},bindAction:function(){var n=this,r=e(n);r.mouseleave(function(){var e=n.score.val()||undefined;t.initialize.call(n,e),t.setTarget.call(n,e,n.opt.targetKeep),n.opt.mouseover&&n.opt.mouseover.call(n,e)});var i=n.opt.half?"mousemove":"mouseover";n.opt.cancel&&n.cancel.mouseenter(function(){e(this).attr("src",n.opt.path+n.opt.cancelOn),n.stars.attr("src",n.opt.path+n.opt.starOff),t.setTarget.call(n,null,!0),n.opt.mouseover&&n.opt.mouseover.call(n,null)}).mouseleave(function(){e(this).attr("src",n.opt.path+n.opt.cancelOff),n.opt.mouseover&&n.opt.mouseover.call(n,n.score.val()||null)}).click(function(e){n.score.removeAttr("value"),n.opt.click&&n.opt.click.call(n,null,e)}),n.stars.bind(i,function(i){var s=parseInt(this.alt,10);if(n.opt.half){var o=parseFloat((i.pageX-e(this).offset().left)/n.opt.size),u=o>.5?1:.5;s=parseFloat(this.alt)-1+u,t.fill.call(n,s),n.opt.precision&&(s=s-u+o),t.showHalf.call(n,s)}else t.fill.call(n,s);r.data("score",s),t.setTarget.call(n,s,!0),n.opt.mouseover&&n.opt.mouseover.call(n,s,i)}).click(function(e){n.score.val(n.opt.half||n.opt.precision?r.data("score"):this.alt),n.opt.click&&n.opt.click.call(n,n.score.val(),e)})},cancel:function(n){return e(this).each(function(){var r=this,i=e(r);if(i.data("readonly")===!0)return this;n?t.click.call(r,null):t.score.call(r,null),r.score.removeAttr("value")})},click:function(n){return e(this).each(function(){if(e(this).data("readonly")===!0)return this;t.initialize.call(this,n),this.opt.click?this.opt.click.call(this,n):t.error.call(this,'you must add the "click: function(score, evt) { }" callback.'),t.setTarget.call(this,n,!0)})},error:function(t){e(this).html(t),e.error(t)},fill:function(e){var t=this,n=t.stars.length,r=0,i,s,o;for(var u=1;u<=n;u++)i=t.stars.eq(u-1),t.opt.iconRange&&t.opt.iconRange.length>r?(s=t.opt.iconRange[r],t.opt.single?o=u==e?s.on||t.opt.starOn:s.off||t.opt.starOff:o=u<=e?s.on||t.opt.starOn:s.off||t.opt.starOff,u<=s.range&&i.attr("src",t.opt.path+o),u==s.range&&r++):(t.opt.single?o=u==e?t.opt.starOn:t.opt.starOff:o=u<=e?t.opt.starOn:t.opt.starOff,i.attr("src",t.opt.path+o))},fixHint:function(){var t=e(this),n=parseInt(this.score.val(),10),r=this.opt.noRatedMsg;!isNaN(n)&&n>0&&(r=n<=this.opt.hints.length&&this.opt.hints[n-1]!==null?this.opt.hints[n-1]:n),t.data("readonly",!0).css("cursor","default").attr("title",r),this.score.attr("readonly","readonly"),this.stars.attr("title",r)},getScore:function(){var t=[],n;return e(this).each(function(){n=this.score.val(),t.push(n?parseFloat(n):undefined)}),t.length>1?t:t[0]},readOnly:function(n){return this.each(function(){var r=e(this);if(r.data("readonly")===n)return this;this.cancel&&(n?this.cancel.hide():this.cancel.show()),n?(r.unbind(),r.children("img").unbind(),t.fixHint.call(this)):(t.bindAction.call(this),t.unfixHint.call(this)),r.data("readonly",n)})},reload:function(){return t.set.call(this,{})},roundStar:function(e){var t=(e-Math.floor(e)).toFixed(2);if(t>this.opt.round.down){var n=this.opt.starOn;t<this.opt.round.up&&this.opt.halfShow?n=this.opt.starHalf:t<this.opt.round.full&&(n=this.opt.starOff),this.stars.eq(Math.ceil(e)-1).attr("src",this.opt.path+n)}},score:function(){return arguments.length?t.setScore.apply(this,arguments):t.getScore.call(this)},set:function(t){return this.each(function(){var n=e(this),r=n.data("settings"),i=n.clone().removeAttr("style").insertBefore(n);n.remove(),i.raty(e.extend(r,t))}),e(this.selector)},setScore:function(n){return e(this).each(function(){if(e(this).data("readonly")===!0)return this;t.initialize.call(this,n),t.setTarget.call(this,n,!0)})},setTarget:function(n,r){if(this.opt.target){var i=e(this.opt.target);i.length==0&&t.error.call(this,"target selector invalid or missing!");var s=n;!r||s===undefined?s=this.opt.targetText:this.opt.targetType=="hint"?s=s===null&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(s-1)]:s=this.opt.precision?parseFloat(s).toFixed(1):parseInt(s,10),this.opt.targetFormat.indexOf("{score}")<0&&t.error.call(this,'template "{score}" missing!'),n!==null&&(s=this.opt.targetFormat.toString().replace("{score}",s)),i.is(":input")?i.val(s):i.html(s)}},showHalf:function(e){var t=(e-Math.floor(e)).toFixed(1);t>0&&t<.6&&this.stars.eq(Math.ceil(e)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(e){e=e?t.between(e,0,this.opt.number):0,t.fill.call(this,e),e>0&&(this.opt.halfShow&&t.roundStar.call(this,e),this.score.val(e))},unfixHint:function(){for(var t=0;t<this.opt.number;t++)this.stars.eq(t).attr("title",t<this.opt.hints.length&&this.opt.hints[t]!==null?this.opt.hints[t]:t);e(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.attr("readonly","readonly")}};e.fn.raty=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist!")},e.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseover:undefined,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:undefined,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:undefined}}(jQuery);